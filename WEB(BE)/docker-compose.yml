version: '3.2'

networks:
  proxy_network:
    external: true
volumes:
  db-data:

services:
  database:
    image: mariadb
    container_name: database
    volumes:
      - db-data:/var/lib/mysql
    restart: always
    environment:
      - MYSQL_ALLOW_EMPTY_PASSWORD=true

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: phpmyadmin
    environment:
      - PMA_HOST=database
    restart: always
    volumes:
      - /sessions
    networks:
      - default
      - proxy_network

  # reverse proxy 필요 시 사용
  # npm:
  #   container_name: npm
  #   image: 'jc21/nginx-proxy-manager:latest'
  #   networks:
  #     - default
  #     - proxy_network
  #   ports:
  #     - 80:80
  #     - 443:443
  #     - 81:81
  #   volumes:
  #     - ./config/npm/data:/data
  #     - ./config/npm/ssl:/etc/letsencrypt
  #   restart: always
  #   depends_on:
  #     - npm_db
  #
  # npm_db:
  #   image: "jc21/mariadb-aria:latest"
  #   container_name: npm_db
  #   environment:
  #     MYSQL_ROOT_PASSWORD: "npm"
  #     MYSQL_DATABASE: "npm"
  #     MYSQL_USER: "npm"
  #     MYSQL_PASSWORD: "npm"
  #   volumes:
  #     - ./config/npm/db:/var/lib/mysql